<link rel="import" href="../polymer/polymer.html">

<!--
`paper-avatar`
User avatar in material style

@demo demo/index.html 
-->

<dom-module id="paper-avatar">
	<template>
		<style>
			:host {
				display: inline-block;
				box-sizing: border-box;
				position: relative;
				width: 40px;
				height: 40px;
				border-radius: 50%;
				user-select: none;
			}
			
			#label, #img {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				width: 100%;
				height: 100%;
				border-radius: 50%;
			}
			
			#label {
				line-height: 41px;
				text-align: center;
				font-size: 24px;
				font-weight: 400;
				color: rgba(255, 255, 255, .8);
				text-transform: capitalize;
				font-family: "Roboto";
			}
			
			#img.hidden {
				display: none;
			}
		</style>

		<div id="label" title="[[label]]">[[_label(label)]]</div>
		<template is="dom-if" if="[[src]]">
			<img id="img" src="[[src]]" on-load="_onImgLoad" on-error="_onImgError" title="[[color]]">
		</template>

	</template>

	<script>
		Polymer({
			is : 'paper-avatar',

			properties: {
				/*
				 * Image address or base64
				 */
				src: {
					type: String,
					observer: '_observerSrc'
				},

				/*
				 *	Label with username
				 */
				label: {
					type: String,
					observer: '_observerLabel'
				},

				/*
				 * Avatar background color
				 */
				color: {
					type: String,
					observer: '_observerColor'
				}
			},
			
			_observerSrc: function(src){
				console.log(src);
			},
			
			_observerLabel: function(label){
				if(this.label && !this.color)
					this.style.backgroundColor = this._parseColor();
			},
			
			_observerColor: function(color){
				if(color)
					this.style.backgroundColor = color;
			},
			
			_label: function(label){
				if(label)
					return label.substring(0, 2);

				return "";
			},
			
			_onImgLoad: function(e){
				e.currentTarget.classList.remove('hidden');
			},
			
			_onImgError: function(e){
				e.currentTarget.classList.add('hidden');
			},

			_parseColor: function(){
				var COLORS = ["#F44336", "#E91E63", "#9C27B0", "#673AB7", "#3F51B5", "#2196F3", "#03A9F4", "#00BCD4", "#795548", "#009688", "#4CAF50", "#8BC34A", "#CDDC39", "#FFEB3B", "#FFC107", "#FF9800", "#FF5722", "#9E9E9E", "#607D8B"];				
				var hash = 0;

				for(var a = 0; a < this.label.length; a++)
					hash += (this.label.charCodeAt(a) << 5); 

				if(hash >= COLORS.length)
					return COLORS[hash % COLORS.length];

				return COLORS[hash];
			}
		});
	</script>
</dom-module>